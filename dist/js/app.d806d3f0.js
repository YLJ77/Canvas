(function(t){function e(e){for(var a,s,o=e[0],c=e[1],h=e[2],l=0,d=[];l<o.length;l++)s=o[l],n[s]&&d.push(n[s][0]),n[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],a=!0,o=1;o<i.length;o++){var c=i[o];0!==n[c]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var a={},n={app:0},r=[];function s(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=a,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var h=0;h<o.length;h++)e(o[h]);var u=c;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"2e50":function(t,e,i){"use strict";var a=i("f56f"),n=i.n(a);n.a},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var a=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},r=[],s=i("2877"),o={},c=Object(s["a"])(o,n,r,!1,null,null,null),h=c.exports,u=i("8c4f"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("canvas",{attrs:{id:"canvas",width:"600",height:"600"},on:{mousedown:t.onMouseDown,mousemove:t.onMouseMove,mouseup:t.onMouseUp}},[t._v("Canvas not supported")]),i("ul",{attrs:{id:"controls"}},[i("li",[i("label",{attrs:{for:"color"}},[t._v("颜色")]),i("select",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{id:"color"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.color=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"red"}},[t._v("red")]),i("option",{attrs:{value:"green"}},[t._v("green")]),i("option",{attrs:{value:"blue"}},[t._v("blue")]),i("option",{attrs:{value:"orange"}},[t._v("orange")]),i("option",{attrs:{value:"cornflowerblue",selected:""}},[t._v("cornflowerblue")]),i("option",{attrs:{value:"goldenrod"}},[t._v("goldenrod")]),i("option",{attrs:{value:"navy"}},[t._v("navy")]),i("option",{attrs:{value:"purple"}},[t._v("purple")])])]),i("li",[i("label",{attrs:{for:"shape"}},[t._v("形状")]),i("select",{directives:[{name:"model",rawName:"v-model",value:t.shape,expression:"shape"}],attrs:{id:"shape"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.shape=e.target.multiple?i:i[0]},function(e){t.mode="normal"}]}},[i("option",{attrs:{value:"Circle"}},[t._v("circle")]),i("option",{attrs:{value:"Line"}},[t._v("line")]),i("option",{attrs:{value:"RoundedRect"}},[t._v("RoundedRect")]),i("option",{attrs:{value:"Polygon"}},[t._v("Polygon")]),i("option",{attrs:{value:"BezierCurve"}},[t._v("BezierCurve")])])]),i("li",{directives:[{name:"show",rawName:"v-show",value:"Polygon"===t.shape,expression:"shape === 'Polygon'"}]},[i("label",{attrs:{for:"sides"}},[t._v("边数")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.sides,expression:"sides"}],attrs:{type:"text",id:"sides"},domProps:{value:t.sides},on:{input:function(e){e.target.composing||(t.sides=e.target.value)}}})]),i("li",[i("label",{attrs:{for:"normal-radio"}},[t._v("画图")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mode,expression:"mode"}],attrs:{type:"radio",id:"normal-radio",value:"normal"},domProps:{checked:t._q(t.mode,"normal")},on:{change:function(e){t.mode="normal"}}}),i("label",{attrs:{for:"drag-radio"}},[t._v("拖拽")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mode,expression:"mode"}],attrs:{type:"radio",id:"drag-radio",value:"drag"},domProps:{checked:t._q(t.mode,"drag")},on:{change:function(e){t.mode="drag"}}}),i("label",{attrs:{for:"edit-radio"}},[t._v("编辑")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mode,expression:"mode"}],attrs:{type:"radio",id:"edit-radio",value:"edit"},domProps:{checked:t._q(t.mode,"edit")},on:{change:function(e){t.mode="edit"}}}),i("label",{attrs:{for:"rotate-radio"}},[t._v("旋转")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mode,expression:"mode"}],attrs:{type:"radio",id:"rotate-radio",value:"rotate"},domProps:{checked:t._q(t.mode,"rotate")},on:{change:function(e){t.mode="rotate"}}}),i("label",{attrs:{for:"eraser-radio"}},[t._v("橡皮擦")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.mode,expression:"mode"}],attrs:{type:"radio",id:"eraser-radio",value:"erase"},domProps:{checked:t._q(t.mode,"erase")},on:{change:function(e){t.mode="erase"}}}),i("label",{attrs:{for:"guidewireCheckbox"}},[t._v("导线")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.guidewires,expression:"guidewires"}],attrs:{id:"guidewireCheckbox",type:"checkbox",checked:""},domProps:{checked:Array.isArray(t.guidewires)?t._i(t.guidewires,null)>-1:t.guidewires},on:{change:function(e){var i=t.guidewires,a=e.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=t._i(i,r);a.checked?s<0&&(t.guidewires=i.concat([r])):s>-1&&(t.guidewires=i.slice(0,s).concat(i.slice(s+1)))}else t.guidewires=n}}}),i("label",{attrs:{for:"checkbox"}},[t._v("填充:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.isFillColor,expression:"isFillColor"}],attrs:{type:"checkbox",id:"checkbox"},domProps:{checked:Array.isArray(t.isFillColor)?t._i(t.isFillColor,null)>-1:t.isFillColor},on:{change:function(e){var i=t.isFillColor,a=e.target,n=!!a.checked;if(Array.isArray(i)){var r=null,s=t._i(i,r);a.checked?s<0&&(t.isFillColor=i.concat([r])):s>-1&&(t.isFillColor=i.slice(0,s).concat(i.slice(s+1)))}else t.isFillColor=n}}}),i("input",{attrs:{id:"eraseAllButton",type:"button",value:"擦除所有"},on:{click:t.erase}})])])])},d=[],f=i("5d73"),v=i.n(f),y=(i("ac6a"),i("6c7b"),i("f499")),g=i.n(y),p=i("7618"),x=(i("6762"),i("2fdb"),i("a4bb")),b=i.n(x),w=i("061b"),m=i.n(w),k=i("4aa6"),P=i.n(k),S=i("5176"),R=i.n(S);function E(t){var e=t.obj,i=t.exclusiveKey;return e=R()(P()(m()(e)),e),b()(e).forEach(function(t){i.includes(t)||"object"!==Object(p["a"])(e[t])||(e[t]=JSON.parse(g()(e[t])))}),e}function O(t){var e=t.x,i=t.y,a=t.radius,n=void 0===a?5:a,r=t.ctx,s=t.color,o=void 0===s?"red":s;r.save(),r.beginPath(),r.fillStyle=o,r.arc(e,i,n,0,2*Math.PI,!1),r.fill(),r.restore()}function T(t){var e=t.ctx,i=t.imgData;e.putImageData(i,0,0)}function _(t){var e=t.ctx,i=t.canvas;return e.getImageData(0,0,i.width,i.height)}function M(t){var e=t.x,i=t.y,a=t.canvas,n=a.getBoundingClientRect();return{x:e-n.left*(a.width/n.width),y:i-n.top*(a.height/n.height)}}function I(t){var e=t.y,i=t.ctx;i.beginPath(),i.moveTo(0,e+.5),i.lineTo(i.canvas.width,e+.5),i.stroke()}function j(t){var e=t.x,i=t.ctx;i.beginPath(),i.moveTo(e+.5,0),i.lineTo(e+.5,i.canvas.height),i.stroke()}function C(t){var e=t.x,i=t.y,a=t.ctx;a.save(),a.strokeStyle="rgba(0,0,230,0.4)",a.lineWidth=.5,j({x:e,ctx:a}),I({y:i,ctx:a}),a.restore()}function L(t){var e=t.ctx,i=t.color,a=t.stepx,n=t.stepy;e.save(),e.strokeStyle=i,e.lineWidth=.5;for(var r=a+.5;r<e.canvas.width;r+=a)e.beginPath(),e.moveTo(r,0),e.lineTo(r,e.canvas.height),e.stroke();for(var s=n+.5;s<e.canvas.height;s+=n)e.beginPath(),e.moveTo(0,s),e.lineTo(e.canvas.width,s),e.stroke();e.restore()}var A=i("01c8"),D=i("768b"),N=i("75fc"),Y=i("308d"),G=i("6bb5"),X=i("4e2b"),F=(i("c5f6"),i("7f7f"),i("b0b4")),z=i("d225"),B=function t(e,i){Object(z["a"])(this,t),this.x=e,this.y=i},K=function(){function t(e){var i=e.ctx,a=e.strokeStyle,n=e.fillStyle,r=e.filled,s=e.startRadians;Object(z["a"])(this,t),this.ctx=i,this.strokeStyle=a,this.fillStyle=n,this.filled=r,this.type=(this instanceof t?this.constructor:void 0).name,this.offsets=null,this.startRadians=s||0,this.pointRadius=5,this.isEditing=!1,this.draggingPoint=null,this.points=[],this.isRotated=!1}return Object(F["a"])(t,[{key:"savePointOffset",value:function(t){var e=this,i=this.points;this.offsets=[],i.forEach(function(i){var a=t.x-i.x,n=t.y-i.y;e.offsets.push({offsetX:a,offsetY:n})})}},{key:"updatePointsOnMoving",value:function(t){var e=this.points,i=this.offsets;e.forEach(function(e,a){e.x=t.x-i[a].offsetX,e.y=t.y-i[a].offsetY}),this.setCenter(t)}},{key:"getRectInfo",value:function(){var t,e,i,a,n,r,s=this.points;return t=e=Number.MAX_VALUE,i=a=Number.MIN_VALUE,s.forEach(function(n){var r=n.x,s=n.y;t=Math.min(t,r),e=Math.min(e,s),i=Math.max(i,r),a=Math.max(a,s)}),n=i-t,r=a-e,{x:t,y:e,width:n,height:r,radius:Math.max(n,r)/2,center:{x:t+n/2,y:e+r/2}}}},{key:"drawControlPoint",value:function(){var t=this,e=this.ctx,i=this.pointRadius,a=this.points;a.forEach(function(a){var n=a.x,r=a.y;e.beginPath(),e.arc(n,r,i,0,2*Math.PI,!1),t.drawPath({filled:!0})})}},{key:"getDraggingPoint",value:function(t){var e=this.points,i=this.ctx,a=this.pointRadius;this.draggingPoint=null;var n=!0,r=!1,s=void 0;try{for(var o,c=v()(e);!(n=(o=c.next()).done);n=!0){var h=o.value;if(i.beginPath(),i.arc(h.x,h.y,a,0,2*Math.PI,!1),i.isPointInPath(t.x,t.y)){this.draggingPoint=h;break}}}catch(u){r=!0,s=u}finally{try{n||null==c.return||c.return()}finally{if(r)throw s}}return this.draggingPoint}},{key:"updatePointOnEditing",value:function(t){var e=this.draggingPoint;e.x=t.x,e.y=t.y,this.setCenter(t)}},{key:"draw",value:function(){var t=this.ctx,e=this.filled,i=this._debugger,a=this.drawDebuggerPoint;this.isEditing&&this.drawControlPoint(),this.createPath(t),this.drawPath({filled:e}),a&&i&&this.drawDebuggerPoint()}},{key:"setShapeTransform",value:function(t){var e=t.radians,i=t.tx,a=t.ty,n=this.ctx,r=Math.sin(e),s=Math.cos(e),o={a:s,c:-r,e:i,b:r,d:s,f:a},c=o.a,h=o.b,u=o.c,l=o.d,d=o.e,f=o.f;n.transform(c,h,u,l,d,f),n.currentTransform=o}},{key:"getTransformPointToScreenPoint",value:function(t){var e=t.x,i=t.y,a=t.tx,n=t.ty,r=this.ctx,s=r.currentTransform,o=s.a,c=s.b,h=s.c,u=s.d,l=s.e,d=s.f;return void 0!==a&&(l=a),void 0!==n&&(d=n),{x:e*o+i*h+l,y:e*c+i*u+d}}},{key:"drawPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.filled,i=void 0!==e&&e,a=this.ctx,n=this.strokeStyle,r=this.fillStyle;a.save(),a.strokeStyle=n,a.stroke(),i&&(a.fillStyle=r,a.fill()),a.restore()}},{key:"updatePointAfterRotated",value:function(){}},{key:"createPath",value:function(){}},{key:"setCenter",value:function(){}},{key:"rotate",value:function(){}}]),t}(),W=function(t){function e(t){var i,a=t.ctx,n=t.startRadians,r=t.fillStyle,s=t.strokeStyle,o=t.endPoints,c=t.controlPoints;return Object(z["a"])(this,e),i=Object(Y["a"])(this,Object(G["a"])(e).call(this,{ctx:a,strokeStyle:s,fillStyle:r,startRadians:n,filled:!1})),i.endPoints=o,i.controlPoints=c,i.points=[].concat(Object(N["a"])(i.endPoints),Object(N["a"])(i.controlPoints)),i.setCenter(),i}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"setCenter",value:function(){var t=this.getRectInfo(),e=t.width,i=t.height,a=t.x,n=t.y;this.radius=Math.sqrt(Math.pow(e,2)+Math.pow(i,2)),this.x=e/2+a,this.y=i/2+n}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.ctx,i=this.x,a=this.y,n=this.points,r=JSON.parse(g()(n));e.save(),this.startRadians=t,this.setShapeTransform({radians:t,tx:i,ty:a}),this.x=0,this.y=0,n.forEach(function(t){t.x-=i,t.y-=a}),this.draw(),e.restore(),this.x=i,this.y=a,this.points=r}},{key:"updatePointAfterRotated",value:function(){var t=this,e=this.points,i=this.x,a=this.y;e.forEach(function(e){var n=e.x,r=e.y;n-=i,r-=a;var s=t.getTransformPointToScreenPoint({x:n,y:r});e.x=s.x,e.y=s.y})}},{key:"drawCurve",value:function(){this.createCurvePath(),this.drawPath()}},{key:"createCurvePath",value:function(){var t=Object(D["a"])(this.points,4),e=t[0],i=t[1],a=t[2],n=t[3],r=this.ctx;r.beginPath(),r.moveTo(e.x,e.y),r.bezierCurveTo(a.x,a.y,n.x,n.y,i.x,i.y)}},{key:"createRectPath",value:function(){var t=this.getRectInfo(),e=t.x,i=t.y,a=t.width,n=t.height,r=this.ctx,s=this.pointRadius;r.beginPath(),r.rect(e-s,i-s,a+2*s,n+2*s),r.closePath()}},{key:"createPath",value:function(){this.createRectPath()}},{key:"draw",value:function(){this.isEditing&&this.drawControlPoint(),this.drawCurve()}}]),e}(K),H=function(t){function e(t){var i,a=t.ctx,n=t.filled,r=t.fillStyle,s=t.strokeStyle,o=t.beginX,c=t.beginY,h=t.endX,u=t.endY,l=t.startRadians;return Object(z["a"])(this,e),i=Object(Y["a"])(this,Object(G["a"])(e).call(this,{ctx:a,strokeStyle:s,filled:n,fillStyle:r,startRadians:l})),i.radius=Math.sqrt(Math.pow(Math.abs(o-h),2)+Math.pow(Math.abs(c-u),2)),i.points=[{x:o,y:c},{x:h,y:u}],i.setCenter(),i}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"setCenter",value:function(){var t=Object(D["a"])(this.points,1),e=t[0];this.x=e.x,this.y=e.y}},{key:"updatePointAfterRotated",value:function(){var t=Object(D["a"])(this.points,2),e=t[0],i=t[1];i.x-=e.x,i.y-=e.y;var a=this.getTransformPointToScreenPoint({x:i.x,y:i.y});i.x=a.x,i.y=a.y}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.ctx,i=Object(D["a"])(this.points,2),a=i[0],n=i[1],r=this.points,s=a.x,o=a.y,c=JSON.parse(g()(r));e.save(),this.setShapeTransform({radians:t,tx:s,ty:o}),a.x=0,a.y=0,n.x-=s,n.y-=o,this.draw(),e.restore(),this.points=c}},{key:"createRectPath",value:function(){var t=Object(D["a"])(this.points,2),e=t[0],i=t[1],a=this.ctx,n=this.pointRadius;a.beginPath();var r=Math.min(e.x,i.x)-n,s=Math.min(e.y,i.y)-n,o=Math.abs(e.x-i.x)+2*n,c=Math.abs(e.y-i.y)+2*n;a.rect(r,s,o,c)}},{key:"createPath",value:function(){this.createRectPath()}},{key:"createLinePath",value:function(){var t=Object(D["a"])(this.points,2),e=t[0],i=t[1],a=this.ctx;a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(i.x,i.y)}},{key:"drawLine",value:function(){this.createLinePath(),this.drawPath()}},{key:"draw",value:function(){var t=this.isEditing;t&&this.drawControlPoint(),this.drawLine()}}]),e}(K),q=function(t){function e(t){var i,a=t.centerX,n=t.centerY,r=t.radius,s=t.ctx,o=t.filled,c=t.strokeStyle,h=t.fillStyle;return Object(z["a"])(this,e),i=Object(Y["a"])(this,Object(G["a"])(e).call(this,{ctx:s,strokeStyle:c,fillStyle:h,filled:o})),i.x=a,i.y=n,i.radius=r,i.setPoints(),i}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"setPoints",value:function(){var t=this.x,e=this.y,i=this.radius;this.points=[{x:t,y:e,isCenter:!0},{x:t,y:e-i},{x:t+i,y:e},{x:t,y:e+i},{x:t-i,y:e}]}},{key:"setCenter",value:function(t){var e=this.draggingPoint;if(e){var i=this.draggingPoint.isCenter;if(i){var a=this.draggingPoint,n=a.x,r=a.y;this.x=n,this.y=r}else{var s=this.x,o=this.y,c=t.x-s,h=t.y-o;this.radius=Math.sqrt(Math.pow(c,2)+Math.pow(h,2))}this.setPoints()}else{var u=Object(D["a"])(this.points,1),l=u[0],d=l.x,f=l.y;this.x=d,this.y=f}}},{key:"createCirclePath",value:function(){var t=this.ctx,e=Object(D["a"])(this.points,1),i=e[0],a=i.x,n=i.y,r=this.radius;t.beginPath(),t.arc(a,n,r,0,2*Math.PI,!1)}},{key:"createPath",value:function(){this.createCirclePath()}}]),e}(K),U=function(t){function e(t){var i,a=t.ctx,n=t.width,r=t.height,s=t.startRadians,o=t.cornerRadius,c=void 0===o?10:o,h=t.cornerX,u=t.cornerY,l=t.fillStyle,d=t.strokeStyle,f=t.filled;return Object(z["a"])(this,e),i=Object(Y["a"])(this,Object(G["a"])(e).call(this,{fillStyle:l,filled:f,strokeStyle:d,startRadians:s,ctx:a})),i.x=n/2+h,i.y=r/2+u,i.cornerX=h,i.cornerY=u,i.cornerRadius=c,i.width=n,i.height=r,i.radius=Math.sqrt(Math.pow(n,2)+Math.pow(r,2)),i._debugger=!1,i.setControlPoint(),i}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"setControlPoint",value:function(){var t=this.cornerX,e=this.cornerY,i=this.cornerRadius,a=this.width,n=this.height,r=t+i,s=t+a,o=e+n;this.controlPoint=[{x:r,y:e},{cx1:s,cy1:e,cx2:s,cy2:o},{cx1:s,cy1:o,cx2:t,cy2:o},{cx1:t,cy1:o,cx2:t,cy2:e},{cx1:t,cy1:e,cx2:r,cy2:e}]}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.ctx,i=this.width,a=this.height,n=this.cornerX,r=this.cornerY,s=this.x,o=this.y,c=-i/2,h=-a/2;this.isRotated=!0,this.startRadians=t,e.save(),this.setShapeTransform({radians:t,tx:s,ty:o}),this.x=0,this.y=0,this.cornerX=c,this.cornerY=h,this.setControlPoint(),this.draw(),e.restore(),this.x=s,this.y=o,this.cornerX=n,this.cornerY=r}},{key:"updatePointAfterRotated",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.tx,a=e.ty,n=this.cornerRadius,r=this.width,s=this.height,o=this.controlPoint,c=-r/2,h=-s/2,u=c+n,l=c+r,d=h+s,f=[];o.forEach(function(e,n){var r,s,o;switch(n){case 0:r=t.getTransformPointToScreenPoint({x:u,y:h,tx:i,ty:a});break;case 1:s=t.getTransformPointToScreenPoint({x:l,y:h,tx:i,ty:a}),o=t.getTransformPointToScreenPoint({x:l,y:d,tx:i,ty:a});break;case 2:s=t.getTransformPointToScreenPoint({x:l,y:d,tx:i,ty:a}),o=t.getTransformPointToScreenPoint({x:c,y:d,tx:i,ty:a});break;case 3:s=t.getTransformPointToScreenPoint({x:c,y:d,tx:i,ty:a}),o=t.getTransformPointToScreenPoint({x:c,y:h,tx:i,ty:a});break;case 4:s=t.getTransformPointToScreenPoint({x:c,y:h,tx:i,ty:a}),o=t.getTransformPointToScreenPoint({x:u,y:h,tx:i,ty:a});break}0===n?f.push({x:r.x,y:r.y}):f.push({cx1:s.x,cy1:s.y,cx2:o.x,cy2:o.y}),t.controlPoint=f})}},{key:"savePointOffset",value:function(t){var e=this.cornerX,i=this.cornerY,a=t.x-e,n=t.y-i;this.offsets=[{offsetX:a,offsetY:n}]}},{key:"updatePointsOnMoving",value:function(t){var e=this;this.offsets.forEach(function(i){e.cornerX=t.x-i.offsetX,e.cornerY=t.y-i.offsetY});var i=this.width,a=this.height,n=this.cornerX,r=this.cornerY,s=this.isRotated;this.x=i/2+n,this.y=a/2+r,s?this.updatePointAfterRotated({tx:this.x,ty:this.y}):this.setControlPoint({cornerX:n,cornerY:r})}},{key:"updatePointOnEditing",value:function(){}},{key:"createPath",value:function(){var t=this.ctx,e=this.controlPoint,i=this.cornerRadius,a=Object(A["a"])(e),n=a[0],r=a.slice(1);t.beginPath(),t.moveTo(n.x,n.y),r.forEach(function(e){var a=e.cx1,n=e.cy1,r=e.cx2,s=e.cy2;t.arcTo(a,n,r,s,i)}),t.closePath()}},{key:"drawDebuggerPoint",value:function(){var t=this.ctx,e=this.controlPoint,i=Object(A["a"])(e),a=i[0],n=i.slice(1),r=4;O({x:a.x,y:a.y,ctx:t,radius:r}),n.forEach(function(e){var i=e.cx1,a=e.cy1,n=e.cx2,s=e.cy2;O({x:i,y:a,ctx:t,color:"green",radius:r}),O({x:n,y:s,ctx:t,color:"yellow",radius:r})})}}]),e}(K),J=function(t){function e(t){var i,a=t.centerX,n=t.centerY,r=t.radius,s=t.sides,o=t.startRadians,c=t.strokeStyle,h=t.fillStyle,u=t.filled,l=t.ctx;return Object(z["a"])(this,e),i=Object(Y["a"])(this,Object(G["a"])(e).call(this,{ctx:l,filled:u,fillStyle:h,strokeStyle:c,startRadians:o})),i.x=a,i.y=n,i.radius=r,i.sides=s,i.points=i.getPoints(),i}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.ctx,i=this.x,a=this.y,n=this.points,r=JSON.parse(g()(n));e.save(),this.setShapeTransform({radians:t,tx:i,ty:a}),this.x=0,this.y=0,n.forEach(function(t){t.x-=i,t.y-=a}),this.draw(),e.restore(),this.x=i,this.y=a,this.points=r}},{key:"setCenter",value:function(){var t=this.getRectInfo(),e=t.center,i=e.x,a=e.y,n=t.radius;this.x=i,this.y=a,this.radius=n}},{key:"getPoints",value:function(){for(var t=[],e=this.startRadians||0,i=0;i<this.sides;++i)t.push(new B(this.x+this.radius*Math.sin(e),this.y-this.radius*Math.cos(e))),e+=2*Math.PI/this.sides;return t}},{key:"createPolygonPath",value:function(){var t=this.ctx,e=this.points;t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<this.sides;++i)t.lineTo(e[i].x,e[i].y);t.closePath()}},{key:"createPath",value:function(){this.createPolygonPath()}},{key:"drawPolygon",value:function(){var t=this.filled;this.createPolygonPath(),this.drawPath({filled:t})}},{key:"draw",value:function(){this.isEditing&&this.drawControlPoint(),this.drawPolygon()}},{key:"updatePointAfterRotated",value:function(){var t=this,e=this.points,i=this.x,a=this.y;e.forEach(function(e){var n=e.x,r=e.y;n-=i,r-=a;var s=t.getTransformPointToScreenPoint({x:n,y:r});e.x=s.x,e.y=s.y})}}]),e}(K),$=function(){function t(e){var i=e.ctx,a=e.shape,n=e.loc,r=e.rotatingLockRadians;Object(z["a"])(this,t),this.ctx=i,this.shape=a,this.loc=n,this.rotatingLockRadians=r,this.RADIUS=10,this.STROKE_STYLE="rgba(0, 0, 0, 0.8)",this.FILL_STYLE="rgba(255, 255, 255, 0.2)",this.SHADOW_COLOR="rgba(255, 255, 255, 0.4)",this.DEGREE_RING_MARGIN=35,this.TRACKING_RING_MARGIN=55,this.DEGREE_ANNOTATIONS_FILL_STYLE="rgba(0, 0, 230, 0.8)",this.DEGREE_ANNOTATIONS_TEXT_SIZE=11,this.DEGREE_OUTER_RING_MARGIN=this.DEGREE_RING_MARGIN,this.TICK_WIDTH=10,this.TICK_LONG_STROKE_STYLE="rgba(100, 140, 230, 0.9)",this.TICK_SHORT_STROKE_STYLE="rgba(100, 140, 230, 0.7)",this.TRACKING_RING_STROKING_STYLE="rgba(100, 140, 230, 0.3)"}return Object(F["a"])(t,[{key:"drawCentroid",value:function(){var t=this.ctx,e=this.shape,i=e.x,a=e.y,n=this.STROKE_STYLE,r=this.FILL_STYLE,s=this.SHADOW_COLOR,o=this.RADIUS;t.beginPath(),t.save(),t.strokeStyle=n,t.fillStyle=r,t.shadowColor=s,t.arc(i,a,o,0,2*Math.PI,!1),t.stroke(),t.fill(),t.restore()}},{key:"drawCentroidGuidewire",value:function(){var t,e,i=this.loc,a=this.shape,n=this.ctx,r=this.FILL_STYLE,s=this.TRACKING_RING_MARGIN,o=this.rotatingLockRadians,c=Math.atan((i.y-a.y)/(i.x-a.x));t=a.radius+s,c-=o,e=i.x>=a.x?{x:a.x+t*Math.cos(c),y:a.y+t*Math.sin(c)}:{x:a.x-t*Math.cos(c),y:a.y-t*Math.sin(c)},n.save(),n.beginPath(),n.moveTo(a.x,a.y),n.lineTo(e.x,e.y),n.stroke(),n.beginPath(),n.arc(e.x,e.y,5,0,2*Math.PI,!1),n.stroke(),n.fillStyle=r,n.fill(),n.restore()}},{key:"drawDegreeOuterDial",value:function(){var t=this.ctx,e=this.shape,i=this.DEGREE_OUTER_RING_MARGIN;t.save(),t.strokeStyle="rgba(0, 0, 0, 0.1)",t.arc(e.x,e.y,e.radius+i,0,2*Math.PI,!0),t.stroke(),t.restore()}},{key:"drawDegreeAnnotations",value:function(){var t=this.shape,e=this.TICK_WIDTH,i=this.DEGREE_RING_MARGIN,a=this.ctx,n=this.DEGREE_ANNOTATIONS_FILL_STYLE,r=this.DEGREE_ANNOTATIONS_TEXT_SIZE,s=t.radius+i;a.save(),a.fillStyle=n,a.font=r+"px Helvetica",a.textAlign="center",a.textBaseline="middle";for(var o=0;o<2*Math.PI;o+=Math.PI/8)a.beginPath(),a.fillText((180*o/Math.PI).toFixed(0),t.x+Math.cos(o)*(s-2*e),t.y+Math.sin(o)*(s-2*e));a.restore()}},{key:"drawDegreeDialTicks",value:function(){var t=this.shape,e=this.DEGREE_RING_MARGIN,i=this.ctx,a=this.TICK_WIDTH,n=this.TICK_LONG_STROKE_STYLE,r=this.TICK_SHORT_STROKE_STYLE,s=t.radius+e,o=2*Math.PI,c=Math.PI/64;i.save();for(var h=0,u=0;h<o;h+=c,++u)i.beginPath(),u%4===0?(i.moveTo(t.x+Math.cos(h)*(s-a),t.y+Math.sin(h)*(s-a)),i.lineTo(t.x+Math.cos(h)*s,t.y+Math.sin(h)*s),i.strokeStyle=n,i.stroke()):(i.moveTo(t.x+Math.cos(h)*(s-a/2),t.y+Math.sin(h)*(s-a/2)),i.lineTo(t.x+Math.cos(h)*s,t.y+Math.sin(h)*s),i.strokeStyle=r,i.stroke()),i.restore()}},{key:"drawDegreeInnerDial",value:function(){var t=this.shape,e=this.ctx,i=this.DEGREE_RING_MARGIN,a=this.TICK_WIDTH;e.save(),e.strokeStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.arc(t.x,t.y,t.radius+i-a,0,2*Math.PI,!1),e.stroke(),e.restore()}},{key:"drawOutMostDial",value:function(){var t=this.shape,e=this.ctx,i=this.TRACKING_RING_STROKING_STYLE,a=this.TRACKING_RING_MARGIN;e.save(),e.shadowColor="rgba(0, 0, 0, 0.7)",e.shadowOffsetX=3,e.shadowOffsetY=3,e.shadowBlur=6,e.strokeStyle=i,e.arc(t.x,t.y,t.radius+a,0,2*Math.PI,!1),e.stroke(),e.restore()}},{key:"draw",value:function(){var t=this.ctx;this.drawCentroid(),this.drawCentroidGuidewire(),t.beginPath(),this.drawOutMostDial(),this.drawDegreeOuterDial(),t.fillStyle="rgba(100, 140, 230, 0.1)",t.fill(),t.beginPath(),this.drawDegreeOuterDial(),t.stroke(),this.drawDegreeDialTicks(),this.drawDegreeInnerDial(),this.drawDegreeAnnotations()}}]),t}(),V=i("59ad"),Z=i.n(V),Q=function(){function t(e){var i=e.type,a=e.width,n=e.ctx;Object(z["a"])(this,t),this.ctx=n,this.type=i,this.width=a,this.ERASER_LINE_WIDTH=1,this.ERASER_SHADOW_COLOR="rgb(0,0,0)",this.ERASER_SHADOW_STYLE="blue",this.ERASER_STROKE_STYLE="rgb(0,0,255)",this.ERASER_SHADOW_OFFSET=-5,this.ERASER_SHADOW_BLUR=20}return Object(F["a"])(t,[{key:"setDrawPath",value:function(t){var e=this.width,i=this.ctx,a=this.type,n=Z()(e);i.beginPath(),"circle"===a?i.arc(t.x,t.y,n/2,0,2*Math.PI,!1):i.rect(t.x-n/2,t.y-n/2,n,n),i.clip()}},{key:"setErasePath",value:function(t){var e=this.width,i=this.ctx,a=this.type,n=this.ERASER_LINE_WIDTH;i.beginPath(),"circle"===a?i.arc(t.x,t.y,e/2+n,0,2*Math.PI,!1):i.rect(t.x-e/2-n,t.y-e/2-n,e+2*n,e+2*n),i.clip()}},{key:"setEraserAttributes",value:function(){var t=this.ctx,e=this.ERASER_LINE_WIDTH,i=this.ERASER_SHADOW_BLUR,a=this.ERASER_SHADOW_OFFSET,n=this.ERASER_SHADOW_STYLE,r=this.ERASER_STROKE_STYLE;t.lineWidth=e,t.shadowColor=n,t.shadowOffsetX=a,t.shadowOffsetY=a,t.shadowBlur=i,t.strokeStyle=r}},{key:"eraseLast",value:function(t){var e=this.ctx,i=10,a=10,n="lightblue";e.save(),this.setErasePath(t),e.fillStyle="white",e.fill(),L({ctx:e,color:n,stepx:i,stepy:a}),e.restore()}},{key:"drawEraser",value:function(t){var e=this.ctx;e.save(),this.setEraserAttributes(),this.setDrawPath(t),e.stroke(),e.restore()}}]),t}(),tt={data:function(){return{eraserWidth:25,eraserType:"circle",shapes:[],sides:3,startRadians:0,shape:"Line",isFillColor:!1,ctx:null,canvas:null,guidewires:!0,color:"cornflowerblue",rubberbandLine:{drawingSurfaceImageData:null,mousedown:{},rubberbandRect:{},dragging:!1},mode:"normal",selectedShape:null,draggingPoint:!1,rotatingLockEngaged:!1,rotatingLockRadians:0,rotatingShape:null,protractor:null,eraser:null}},mounted:function(){this.getContext(),this.setCanvasSize(),this.drawRubberbandLines(),window.shapes=this.shapes},watch:{mode:function(){var t=this.canvas,e=this.mode;switch(e){case"drag":case"edit":case"rotate":case"erase":t.style.cursor="pointer";break;case"normal":t.style.cursor="crosshair";break}this.inactiveEditing(),this.redraw()}},methods:{setCanvasSize:function(){var t=this.canvas;t.width=window.innerWidth,t.height=window.innerHeight},stopRotatingShape:function(t){var e=this.selectedShape,i=this.rotatingLockRadians,a=Math.atan((t.y-e.y)/(t.x-e.x))-i;e.startRadians+=a,e.isRotated=!0,e.updatePointAfterRotated(),this.rotatingShape=void 0,this.rotatingLockEngaged=!1,this.rotatingLockRadians=0,this.redraw()},saveCanvasInfo:function(t){var e=this.rubberbandLine.mousedown,i=this.rubberbandLine,a=this.ctx,n=this.canvas;i.drawingSurfaceImageData=_({ctx:a,canvas:n}),e.x=t.x,e.y=t.y,i.dragging=!0},drawShapes:function(){var t=this.shapes;t.forEach(function(t){t.draw()})},drawBezierCurve:function(){var t=this.getEndAndControlPoints(),e=t.endPoints,i=t.controlPoints,a=this.ctx,n=this.shapes,r=this.rubberbandLine.dragging,s=this.color,o=new W({ctx:a,strokeStyle:s,fillStyle:s,endPoints:e,controlPoints:i});o.draw(),r||n.push(o)},getEndAndControlPoints:function(){var t=[{},{}],e=[{},{}],i=this.rubberbandLine.rubberbandRect,a=i.left,n=i.top,r=i.width,s=i.height;return t[0].x=a,t[0].y=n,t[1].x=a+r,t[1].y=n+s,e[0].x=a,e[0].y=n+s,e[1].x=a+r,e[1].y=n,{endPoints:t,controlPoints:e}},drawPolygon:function(){var t=this.rubberbandLine,e=t.dragging,i=t.rubberbandRect.width,a=t.mousedown,n=a.x,r=a.y,s=this.ctx,o=this.sides,c=this.startRadians,h=this.isFillColor,u=this.color,l=this.shapes,d=new J({centerX:n,centerY:r,radius:i,sides:o,startRadians:c,strokeStyle:u,fillStyle:u,filled:h,ctx:s});d.draw(),e||l.push(d)},getContext:function(){this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d")},erase:function(){var t=this.ctx,e=this.canvas;t.clearRect(0,0,e.width,e.height),L({ctx:t,color:"lightblue",stepx:10,stepy:10}),_({ctx:t,canvas:e})},drawRubberbandLines:function(){var t=this.ctx,e=this.color;t.strokeStyle=e,L({ctx:t,color:"lightblue",stepx:10,stepy:10})},updateRubberbandRect:function(t){var e=t.loc,i=this.rubberbandLine,a=i.rubberbandRect,n=i.mousedown;a.width=Math.abs(e.x-n.x),a.height=Math.abs(e.y-n.y),e.x>n.x?a.left=n.x:a.left=e.x,e.y>n.y?a.top=n.y:a.top=e.y},drawRubberbandShape:function(t){var e=t.loc,i=this.shape;this["draw".concat(i)]({loc:e})},drawRoundedRect:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.cornerRadius,i=void 0===e?10:e,a=this.ctx,n=this.color,r=this.isFillColor,s=this.shapes,o=this.rubberbandLine,c=o.dragging,h=o.rubberbandRect,u=h.width,l=h.height,d=o.mousedown,f=d.x,v=d.y,y=new U({ctx:a,filled:r,strokeStyle:n,fillStyle:n,width:u,height:l,cornerX:f,cornerY:v,cornerRadius:i});y.draw(),c||s.push(y)},drawCircle:function(t){var e,i=t.loc,a=this.ctx,n=this.rubberbandLine,r=n.dragging,s=n.rubberbandRect,o=s.width,c=s.height,h=n.mousedown,u=h.x,l=h.y,d=this.color,f=this.isFillColor,v=this.shapes;e=l===i.y?Math.abs(i.x-u):Math.sqrt(Math.pow(o,2)+Math.pow(c,2));var y=new q({centerX:u,centerY:l,radius:e,ctx:a,filled:f,strokeStyle:d,fillStyle:d});y.draw(),r||v.push(y)},drawLine:function(t){var e=t.loc,i=this.ctx,a=this.rubberbandLine,n=a.mousedown,r=n.x,s=n.y,o=a.dragging,c=this.color,h=this.shapes,u=e.x,l=e.y,d=new H({ctx:i,strokeStyle:c,fillStyle:c,beginX:r,beginY:s,endX:u,endY:l,filled:!1});d.draw(),o||h.push(d)},updateRubberband:function(t){var e=t.loc;this.updateRubberbandRect({loc:e}),this.drawRubberbandShape({loc:e})},inactiveEditing:function(){var t=this.shapes;t.forEach(function(t){t.isEditing=!1})},activeEditing:function(t){var e=t.shape;this.inactiveEditing(),e.isEditing=!0},getSelectedShape:function(t){var e=t.loc,i=this.shapes,a=this.ctx,n=this.mode,r=!0,s=!1,o=void 0;try{for(var c,h=v()(i);!(r=(c=h.next()).done);r=!0){var u=c.value,l=u.getDraggingPoint(e);if(u.createPath(),a.isPointInPath(e.x,e.y)||"edit"===n&&l){switch(this.selectedShape=u,n){case"edit":this.activeEditing({shape:u}),this.redraw(),u.savePointOffset(e);break;case"drag":u.savePointOffset(e);break;case"rotate":this.rotatingShape=E({obj:u,exclusiveKey:["ctx"]});break}break}this.selectedShape=null,"edit"===n&&(this.inactiveEditing(),this.redraw())}}catch(d){s=!0,o=d}finally{try{r||null==h.return||h.return()}finally{if(s)throw o}}},initProtractor:function(t){var e=this.ctx,i=this.rotatingLockRadians,a=this.rotatingLockEngaged,n=this.rotatingShape;if(this.rotatingShape){var r=new $({ctx:e,shape:n,loc:t,rotatingLockRadians:i});r.draw(),a||(this.rotatingLockEngaged=!0,this.rotatingLockRadians=Math.atan((t.y-n.y)/(t.x-n.x))),this.protractor=r}},rotateShape:function(t){var e=this.rotatingLockEngaged,i=this.rotatingLockRadians,a=this.protractor,n=this.rotatingShape;if(e){var r=t.y-n.y,s=t.x-n.x,o=Math.atan(r/s)-i;(s<0&&r>0||s<0&&r<=0)&&(o=Math.PI+o),this.redraw(),n.rotate(o),a.loc=t,a.draw()}},onMouseDown:function(t){var e=this.canvas,i=this.mode,a=this.rotatingShape,n=this.ctx,r=this.eraser,s=t.clientX,o=t.clientY,c=M({x:s,y:o,canvas:e});switch(t.preventDefault(),this.saveCanvasInfo(c),i){case"drag":this.getSelectedShape({loc:c});break;case"edit":this.getSelectedShape({loc:c});break;case"rotate":a?this.stopRotatingShape(c):(this.getSelectedShape({loc:c}),this.initProtractor(c));break;case"erase":if(!r){var h=this.eraserType,u=this.eraserWidth;this.eraser=new Q({ctx:n,type:h,width:u})}break}"edit"!==i&&this.existEditingShap()&&(this.inactiveEditing(),this.redraw())},existEditingShap:function(){var t=this.shapes;return t.some(function(t){return t.isEditing})},onMouseMove:function(t){var e=this.canvas,i=this.ctx,a=this.guidewires,n=this.shape,r=this.rubberbandLine,s=r.mousedown,o=r.dragging,c=r.drawingSurfaceImageData,h=this.mode,u=this.selectedShape,l=this.rotatingShape,d=this.eraser,f=t.clientX,v=t.clientY;t.preventDefault();var y=M({x:f,y:v,canvas:e});if(o){switch(h){case"drag":u&&u.updatePointsOnMoving(y);break;case"edit":u&&u.draggingPoint&&u.updatePointOnEditing(y);break;case"erase":d.eraseLast({x:s.x,y:s.y}),d.drawEraser(y),this.rubberbandLine.mousedown=y;break;case"normal":if(T({ctx:i,imgData:c}),this.updateRubberband({loc:y}),a){var g="Line"===n?y:s;C({ctx:i,x:g.x,y:g.y})}break}"drag"!==h&&"edit"!==h||this.redraw()}"rotate"===h&&l&&this.rotateShape(y)},onMouseUp:function(t){var e=this.ctx,i=this.canvas,a=this.rubberbandLine,n=this.rubberbandLine,r=n.drawingSurfaceImageData,s=n.mousedown,o=this.mode,c=this.eraser,h=this.selectedShape,u=t.clientX,l=t.clientY,d=M({x:u,y:l,canvas:i});switch(a.dragging=!1,o){case"normal":T({ctx:e,imgData:r}),this.updateRubberband({loc:d});break;case"erase":c.eraseLast(s);break;case"edit":case"drag":if(h){var f=h.type;switch(f){case"BezierCurve":h.setCenter();break}}break}},redraw:function(){var t=this.ctx,e=this.canvas;t.clearRect(0,0,e.width,e.height),L({ctx:t,color:"lightblue",stepx:10,stepy:10}),this.drawShapes()}}},et=tt,it=(i("2e50"),Object(s["a"])(et,l,d,!1,null,"fcb2d3bc",null)),at=it.exports,nt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},rt=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("canvas",{attrs:{id:"screen",width:"640",height:"640"}},[t._v("canvas not supported")])])}],st=(i("96cf"),i("3b8d")),ot=i("795b"),ct=i.n(ot),ht=i("b6d0"),ut=i.n(ht),lt=function(){function t(){Object(z["a"])(this,t),this.layers=[]}return Object(F["a"])(t,[{key:"draw",value:function(t,e){this.layers.forEach(function(i){i(t,e)})}}]),t}(),dt=function(){function t(){Object(z["a"])(this,t),this.grid=[]}return Object(F["a"])(t,[{key:"forEach",value:function(t){this.grid.forEach(function(e,i){e.forEach(function(e,a){t(e,i,a)})})}},{key:"get",value:function(t,e){var i=this.grid[t];if(i)return i[e]}},{key:"set",value:function(t,e,i){this.grid[t]||(this.grid[t]=[]),this.grid[t][e]=i}}]),t}(),ft=function(){function t(e,i){Object(z["a"])(this,t),this.set(e,i)}return Object(F["a"])(t,[{key:"set",value:function(t,e){this.x=t,this.y=e}}]),t}(),vt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;Object(z["a"])(this,t),this.matrix=e,this.tileSize=i}return Object(F["a"])(t,[{key:"toIndex",value:function(t){return Math.floor(t/this.tileSize)}},{key:"toIndexRange",value:function(t,e){var i=Math.ceil(e/this.tileSize)*this.tileSize,a=[],n=t;do{a.push(this.toIndex(n)),n+=this.tileSize}while(n<i);return a}},{key:"getByIndex",value:function(t,e){var i=this.matrix.get(t,e);if(i){var a=t*this.tileSize,n=a+this.tileSize,r=e*this.tileSize,s=r+this.tileSize;return{tile:i,x1:a,x2:n,y1:r,y2:s}}}},{key:"searchByPosition",value:function(t,e){return this.getByIndex(this.toIndex(t),this.toIndex(e))}},{key:"searchByRange",value:function(t,e,i,a){var n=this,r=[];return this.toIndexRange(t,e).forEach(function(t){n.toIndexRange(i,a).forEach(function(e){var i=n.getByIndex(t,e);i&&r.push(i)})}),r}}]),t}(),yt=i("67bb"),gt=i.n(yt),pt={TOP:gt()("top"),BOTTOM:gt()("bottom")},xt=function(){function t(e){Object(z["a"])(this,t),this.NAME=e}return Object(F["a"])(t,[{key:"obstruct",value:function(){}},{key:"update",value:function(){console.warn("Unhandled call")}}]),t}(),bt=function(){function t(){Object(z["a"])(this,t),this.pos=new ft(0,0),this.vel=new ft(0,0),this.size=new ft(0,0),this.traits=[]}return Object(F["a"])(t,[{key:"obstruct",value:function(t){var e=this;this.traits.forEach(function(i){i.obstruct(e,t)})}},{key:"addTrait",value:function(t){this.traits.push(t),this[t.NAME]=t}},{key:"update",value:function(t){var e=this;this.traits.forEach(function(i){i.update(e,t)})}}]),t}(),wt=function(){function t(e){Object(z["a"])(this,t),this.tiles=new vt(e)}return Object(F["a"])(t,[{key:"check",value:function(t,e){var i,a,n;if("x"===e){if(t.vel.x>0)i=t.pos.x+t.size.x;else{if(!(t.vel.x<0))return;i=t.pos.x}n=this.tiles.searchByRange(i,i,t.pos.y,t.pos.y+t.size.y)}else if("y"===e){if(t.vel.y>0)a=t.pos.y+t.size.y;else{if(!(t.vel.y<0))return;a=t.pos.y}n=this.tiles.searchByRange(t.pos.x,t.pos.x+t.size.x,a,a)}n.forEach(function(i){"ground"===i.tile.type&&(t.vel[e]>0?t.pos[e]+t.size[e]>i["".concat(e,"1")]&&(t.pos[e]=i["".concat(e,"1")]-t.size[e],t.vel[e]=0,t.obstruct(pt.BOTTOM)):t.vel[e]<0&&t.pos[e]<i["".concat(e,"2")]&&(t.pos[e]=i["".concat(e,"2")],t.vel[e]=0,t.obstruct(pt.TOP)))})}},{key:"test",value:function(t){this.check(t,"y"),this.check(t,"x")}}]),t}(),mt=function(){function t(){Object(z["a"])(this,t),this.comp=new lt,this.entities=new ut.a,this.tiles=new dt,this.gravity=2e3,this.totalTime=0,this.tileCollider=new wt(this.tiles)}return Object(F["a"])(t,[{key:"update",value:function(t){var e=this;this.entities.forEach(function(i){i.update(t),i.pos.x+=i.vel.x*t,e.tileCollider.check(i,"x"),i.pos.y+=i.vel.y*t,e.tileCollider.check(i,"y"),i.vel.y+=e.gravity*t}),this.totalTime+=t}}]),t}();function kt(t,e){var i,a,n=t.tiles,r=t.tileCollider.tiles,s=document.createElement("canvas"),o=s.getContext("2d");function c(r,s){i=r,a=s;for(var c=function(a){var r=n.grid[a];r&&r.forEach(function(n,r){e.animations.has(n.name)?e.drawAnim(n.name,o,a-i,r,t.totalTime):e.drawTile(n.name,o,a-i,r)})},h=i;h<a;++h)c(h)}return s.width=272,s.height=240,function(t,e){var i=r.toIndex(e.size.x),a=r.toIndex(e.pos.x),n=a+i;c(a,n),t.drawImage(s,-e.pos.x%16,e.pos.y)}}function Pt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,a=document.createElement("canvas");a.width=e,a.height=i;var n=a.getContext("2d");return function(r,s){t.forEach(function(t){n.clearRect(0,0,e,i),t.draw(n),r.drawImage(a,t.pos.x-s.pos.x,t.pos.y-s.pos.y)})}}function St(t){return function(e,i){var a=t.size;e.strokeStyle="purple",e.beginPath(),e.rect(t.pos.x-i.pos.x,t.pos.y-i.pos.y,a.x,a.y),e.stroke()}}var Rt=i("2d7d"),Et=i.n(Rt),Ot=function(){function t(e,i,a){Object(z["a"])(this,t),this.image=e,this.width=i,this.height=a,this.tiles=new Et.a,this.animations=new Et.a}return Object(F["a"])(t,[{key:"defineAnim",value:function(t,e){this.animations.set(t,e)}},{key:"define",value:function(t,e,i,a,n){var r=this,s=[!1,!0].map(function(t){var s=r.image,o=document.createElement("canvas");o.width=a,o.height=n;var c=o.getContext("2d");return t&&(c.scale(-1,1),c.translate(-a,0)),c.drawImage(s,e,i,a,n,0,0,a,n),o});this.tiles.set(t,s)}},{key:"defineTile",value:function(t,e,i){var a=this.width,n=this.height;this.define(t,e*a,i*n,a,n)}},{key:"draw",value:function(t,e,i,a){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=this.tiles.get(t)[Number(n)];e.drawImage(r,i,a)}},{key:"drawAnim",value:function(t,e,i,a,n){var r=this.animations.get(t);this.drawTile(r(n),e,i,a)}},{key:"drawTile",value:function(t,e,i,a){var n=this.width,r=this.height;this.draw(t,e,i*n,a*r)}}]),t}();function Tt(t,e){return function(i){var a=Math.floor(i/e)%t.length,n=t[a];return n}}function _t(t){return new ct.a(function(e){var i=new Image;i.src=t,i.onload=function(){e(i)}})}function Mt(t,e){function i(e,i,a,n,r){for(var s=i+a,o=n+r,c=i;c<s;++c)for(var h=n;h<o;++h)t.tiles.set(c,h,{name:e.tile,type:e.type})}e.forEach(function(t){t.ranges.forEach(function(e){if(4===e.length){var a=Object(D["a"])(e,4),n=a[0],r=a[1],s=a[2],o=a[3];i(t,n,r,s,o)}else if(3===e.length){var c=Object(D["a"])(e,3),h=c[0],u=c[1],l=c[2];i(t,h,u,l,1)}else if(2===e.length){var d=Object(D["a"])(e,2),f=d[0],v=d[1];i(t,f,1,v,1)}})})}function It(t){return jt.apply(this,arguments)}function jt(){return jt=Object(st["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new ct.a(function(t){fetch(e).then(function(e){t(e.json())})}));case 1:case"end":return t.stop()}},t)})),jt.apply(this,arguments)}function Ct(t){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(st["a"])(regeneratorRuntime.mark(function t(e){var i,a,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,It("sprites/".concat(e,".json"));case 2:return i=t.sent,t.next=5,_t(i.imageUrl);case 5:return a=t.sent,n=new Ot(a,i.tileW,i.tileH),i.tiles&&i.tiles.forEach(function(t){n.defineTile(t.name,t.index[0],t.index[1])}),i.frames&&i.frames.forEach(function(t){n.define.apply(n,[t.name].concat(Object(N["a"])(t.rect)))}),i.animations&&i.animations.forEach(function(t){var e=Tt(t.frames,t.frameLen);n.defineAnim(t.name,e)}),t.abrupt("return",n);case 11:case"end":return t.stop()}},t)})),Lt.apply(this,arguments)}function At(t,e){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(st["a"])(regeneratorRuntime.mark(function t(e,i){var a,n,r,s,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,It("levels/".concat(e,".json"));case 2:return a=t.sent,n=new mt,Mt(n,a.backgrounds),t.next=7,Ct(a.spriteSheet);case 7:return r=t.sent,s=kt(n,r),n.comp.layers.push(s),o=Pt(n.entities),n.comp.layers.push(o),t.abrupt("return",n);case 13:case"end":return t.stop()}},t)})),Dt.apply(this,arguments)}var Nt=function(){function t(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/60;Object(z["a"])(this,t);var a=0,n=0;this.updateProxy=function(t){a+=(t-n)/3e3,a>1&&(a=1);while(a>i)e.update(i),a-=i;n=t,e.enqueue()}}return Object(F["a"])(t,[{key:"enqueue",value:function(){requestAnimationFrame(this.updateProxy)}},{key:"start",value:function(){this.enqueue()}}]),t}(),Yt=function(t){function e(){var t;return Object(z["a"])(this,e),t=Object(Y["a"])(this,Object(G["a"])(e).call(this,"jump")),t.ready=0,t.duration=.1,t.velocity=400,t.engageTime=0,t.speedBoost=.3,t.requestTime=0,t.gracePeriod=.5,t}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"start",value:function(){this.requestTime=this.gracePeriod}},{key:"cancel",value:function(){this.engageTime=0,this.requestTime=0}},{key:"obstruct",value:function(t,e){e===pt.BOTTOM&&(this.ready=1),e===pt.TOP&&this.cancel()}},{key:"update",value:function(t,e){this.requestTime>0&&(this.ready>0&&(this.engageTime=this.duration,this.requestTime=0),this.requestTime-=e),this.engageTime>0&&(t.vel.y=-(this.velocity+Math.abs(t.vel.x)*this.speedBoost),this.engageTime-=e),this.ready--}},{key:"falling",get:function(){return this.ready<0}}]),e}(xt),Gt=function(t){function e(){var t;return Object(z["a"])(this,e),t=Object(Y["a"])(this,Object(G["a"])(e).call(this,"go")),t.dir=0,t.acceleration=800,t.deceleration=300,t.dragFactor=2e-4,t.distance=0,t.heading=1,t}return Object(X["a"])(e,t),Object(F["a"])(e,[{key:"update",value:function(t,e){var i=Math.abs(t.vel.x);if(0!==this.dir)t.vel.x+=this.acceleration*this.dir*e,t.jump?!1===t.jump.falling&&(this.heading=this.dir):this.heading=this.dir;else if(0!==t.vel.x){var a=Math.min(i,this.deceleration*e);t.vel.x+=t.vel.x>0?-a:a}else this.distance=0;var n=this.dragFactor*t.vel.x*i;t.vel.x-=n,this.distance+=i*e}}]),e}(xt);function Xt(){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(st["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,r,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s=function(t){return t.jump.falling?"jump":t.go.distance>0?t.vel.x>0&&t.go.dir<0||t.vel.x<0&&t.go.dir>0?"break":r(t.go.distance):"idle"},t.next=3,Ct("mario");case 3:return e=t.sent,i=new bt,a=5e-4,n=2e-4,i.size.set(16,16),i.addTrait(new Gt),i.addTrait(new Yt),i.go.dragFactor=a,r=Tt(["run-1","run-2","run-3"],8),i.draw=function(t){e.draw(s(this),t,0,0,i.go.heading<0)},i.turbo=function(t){this.go.dragFactor=t?n:a},t.abrupt("return",i);case 15:case"end":return t.stop()}},t)})),Ft.apply(this,arguments)}var zt=1,Bt=0,Kt=function(){function t(){Object(z["a"])(this,t),this.keyStates=new Et.a,this.keyMap=new Et.a}return Object(F["a"])(t,[{key:"addMapping",value:function(t,e){this.keyMap.set(t,e)}},{key:"handleEvent",value:function(t){var e=t.code;if(this.keyMap.has(e)){t.preventDefault();var i="keydown"===t.type?zt:Bt;this.keyStates.get(e)!==i&&(this.keyStates.set(e,i),this.keyMap.get(e)(i))}}},{key:"listenTo",value:function(t){var e=this;["keydown","keyup"].forEach(function(i){t.addEventListener(i,function(t){e.handleEvent(t)})})}}]),t}();function Wt(t){var e="Space",i="ArrowRight",a="ArrowLeft",n="ArrowUp",r=new Kt;return r.addMapping(e,function(e){e?t.jump.start():t.jump.cancel()}),r.addMapping(i,function(e){t.go.dir+=e?1:-1}),r.addMapping(a,function(e){t.go.dir+=-e?-1:1}),r.addMapping(n,function(e){t.turbo(e)}),r}var Ht=function t(){Object(z["a"])(this,t),this.pos=new ft(0,0),this.size=new ft(256,224)};function qt(t,e,i){var a;["mousedown","mousemove"].forEach(function(n){t.addEventListener(n,function(t){1===t.buttons?(e.vel.set(0,0),e.pos.set(t.offsetX+i.pos.x,t.offsetY+i.pos.y)):2===t.buttons&&a&&2===a.buttons&&"mousemove"===a.type&&(i.pos.x-=t.offsetX-a.offsetX),a=t})}),t.addEventListener("contextmenu",function(t){t.preventDefault()})}var Ut={data:function(){return{canvas:null,ctx:null}},methods:{draw:function(){var t=Object(st["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,r,s,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.ctx,i=this.canvas,a=new Ht,t.next=4,Xt(e);case 4:return n=t.sent,t.next=7,At("1-1",e);case 7:r=t.sent,window.camera=a,n.pos.set(14,64),r.entities.add(n),r.comp.layers.push(St(a)),s=Wt(n),s.listenTo(window),qt(i,n,a),o=new Nt(1/60),o.update=function(t){r.update(t),n.pos.x>100&&(a.pos.x=n.pos.x-100),r.comp.draw(e,a)},o.start();case 18:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),init:function(){this.canvas=document.getElementById("screen"),this.ctx=this.canvas.getContext("2d")}},mounted:function(){this.init(),this.draw()}},Jt=Ut,$t=(i("d8fb"),Object(s["a"])(Jt,nt,rt,!1,null,"9945e8ba",null)),Vt=$t.exports;a["a"].use(u["a"]);var Zt=new u["a"]({routes:[{path:"/",name:"home",component:at},{path:"/mario",name:"mario",component:Vt}]}),Qt=i("2f62");a["a"].use(Qt["a"]);var te=new Qt["a"].Store({state:{},mutations:{},actions:{}});i("78a7");a["a"].config.productionTip=!1,new a["a"]({router:Zt,store:te,render:function(t){return t(h)}}).$mount("#app")},"737f":function(t,e,i){},"78a7":function(t,e,i){},d8fb:function(t,e,i){"use strict";var a=i("737f"),n=i.n(a);n.a},f56f:function(t,e,i){}});
//# sourceMappingURL=app.d806d3f0.js.map